define("mod_evokeportfolio/addcomment",["jquery","core/str","core/ajax","mod_evokeportfolio/sweetalert"],(function($,Str,Ajax,Swal){var AddComment=function(){this.registerEventListeners()};return AddComment.prototype.registerEventListeners=function(){$(document).on("click",".commentbutton",(function(event){var inputtarget=$(event.currentTarget).closest(".submission").find(".add-comment .input-group .post-comment-input");inputtarget.length>0&&inputtarget.focus()})),$(document).on("click",".post-comment-btn",function(event){var target=$(event.currentTarget).closest(".input-group").children(".post-comment-input");target&&this.saveComment(target,target.html())}.bind(this))},AddComment.prototype.saveComment=function(postinput,value){if(""!==value){var postdiv=postinput.closest(".submission");if(postinput.empty(),0===postdiv.length||postdiv.length>1)this.showToast("error","Error trying to find the discussion for this comment.");else{var id=postdiv.data("id");Ajax.call([{methodname:"mod_evokeportfolio_addcomment",args:{comment:{submissionid:id,message:value}}}])[0].done(function(data){this.addCommentToPost(postdiv,data.comment)}.bind(this)).fail(function(error){var message=error.message;message||(message=error.error),this.showToast("error",message)}.bind(this))}}},AddComment.prototype.showToast=function(type,message){Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:8e3,timerProgressBar:!0,onOpen:toast=>{toast.addEventListener("mouseenter",Swal.stopTimer),toast.addEventListener("mouseleave",Swal.resumeTimer)}}).fire({icon:type,title:message})},AddComment.prototype.addCommentToPost=function(postdiv,comment){Str.get_string("editcomment","mod_evokeportfolio").then((function(editcomment){var userimg=postdiv.find(".add-comment .userimg").clone(),userfullname=userimg.attr("alt"),loadallcomments=postdiv.find(".loadmore"),commentcontainer=$("<div class='submissioncomment fadeIn'><div class='userinfo'><div class='userimg'>"+$("<div/>").append(userimg).html()+"</div><div class='nameanddate'><p class='username'>"+userfullname+"</p><span class='small'>"+comment.humantimecreated+"</span></div><div class='editbutton ml-auto'><a class='btn-editcomment btn btn-sm btn-primary' data-id='"+comment.id+"'>"+editcomment+"</a></div></div><p class='text'>"+comment.message+"</p></div>");loadallcomments.length>0?commentcontainer.insertBefore(loadallcomments):commentcontainer.insertBefore(postdiv.find(".add-comment"));var totalcommentsspan=postdiv.find(".reactions .actions .commentbutton .totalcomments"),totalcomments=postdiv.find(".submissioncomment").length;totalcommentsspan.empty(),totalcommentsspan.text(totalcomments)}))},{init:function(){return new AddComment}}}));

//# sourceMappingURL=addcomment.min.js.map