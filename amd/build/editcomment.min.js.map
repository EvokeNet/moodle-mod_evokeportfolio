{"version":3,"sources":["../src/editcomment.js"],"names":["define","$","Str","ModalFactory","ModalEvents","Ajax","TributeInit","Swal","EditComment","contextid","registerEventListeners","prototype","eventtarget","on","event","preventDefault","currentTarget","commentId","data","textdiv","closest","children","get_string","then","title","create","type","types","SAVE_CANCEL","body","html","modal","getRoot","save","newMessage","getBody","find","saveComment","bind","show","init","id","message","request","call","methodname","args","comment","done","replaceOriginalMessage","showToast","fail","error","submissioncommentdiv","css","window","setInterval","Toast","mixin","toast","position","showConfirmButton","timer","timerProgressBar","onOpen","addEventListener","stopTimer","resumeTimer","fire","icon"],"mappings":"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","sourcesContent":["/**\n * Edit chapter js logic.\n *\n * @copyright  2021 World Bank Group <https://worldbank.org>\n * @author     Willian Mano <willianmanoaraujo@gmail.com>\n */\n/* eslint-disable */\ndefine([\n        'jquery',\n        'core/str',\n        'core/modal_factory',\n        'core/modal_events',\n        'core/ajax',\n        'mod_evokeportfolio/tribute_init',\n        'mod_evokeportfolio/sweetalert',\n        'core/yui'],\n    function($, Str, ModalFactory, ModalEvents, Ajax, TributeInit, Swal, Y) {\n\n        var EditComment = function(contextid) {\n            this.contextid = contextid;\n\n            this.registerEventListeners();\n        };\n\n        /**\n         * @var {int} contextid\n         * @private\n         */\n        EditComment.prototype.contextid = -1;\n\n        /**\n         * @var eventtarget\n         * @private\n         */\n        EditComment.prototype.eventtarget = null;\n\n        EditComment.prototype.registerEventListeners = function() {\n            $(\"body\").on(\"click\", \".btn-editcomment\", function (event) {\n                event.preventDefault();\n\n                this.eventtarget = $(event.currentTarget);\n\n                let commentId = this.eventtarget.data('id');\n\n                var textdiv = this.eventtarget.closest('.submissioncomment').children('.text');\n\n                Str.get_string('editcomment', 'mod_evokeportfolio').then(function(title) {\n                    ModalFactory.create({\n                        type: ModalFactory.types.SAVE_CANCEL,\n                        title: title,\n                        body: '<div class=\"input-group\">' +\n                            '<p class=\"post-comment-input\" contenteditable=\"true\" data-tribute=\"true\">' + textdiv.html() + '</p>' +\n                            '</div>',\n                    }).then(function(modal) {\n                        modal.getRoot().on(ModalEvents.save, function () {\n                            var newMessage = modal.getBody().find('.post-comment-input').html();\n\n                            this.saveComment(commentId, newMessage);\n                        }.bind(this));\n\n                        modal.show().then(TributeInit.init());\n                    }.bind(this));\n                }.bind(this));\n            }.bind(this));\n        }\n\n        EditComment.prototype.saveComment = function(id, message) {\n            var request = Ajax.call([{\n                methodname: 'mod_evokeportfolio_editcomment',\n                args: {\n                    comment: {\n                        id: id,\n                        message: message,\n                    }\n                }\n            }]);\n\n            request[0].done(function(data) {\n                this.replaceOriginalMessage(message);\n\n                this.showToast('success', data.message);\n            }.bind(this)).fail(function(error) {\n                var message = error.message;\n\n                if (!message) {\n                    message = error.error;\n                }\n\n                this.showToast('error', message);\n            }.bind(this));\n        };\n\n        EditComment.prototype.replaceOriginalMessage = function(newMessage) {\n            var submissioncommentdiv = this.eventtarget.closest('.submissioncomment');\n            var textdiv = submissioncommentdiv.children('.text');\n\n            submissioncommentdiv.css('background-color', '#cceecb');\n            submissioncommentdiv.css('transition', 'background 1s');\n\n            window.setInterval(function() {\n                submissioncommentdiv.css('background-color', '#f1f0f0');\n            }, 1000);\n\n            textdiv.html(newMessage);\n        }\n\n        EditComment.prototype.showToast = function(type, message) {\n            var Toast = Swal.mixin({\n                toast: true,\n                position: 'top-end',\n                showConfirmButton: false,\n                timer: 8000,\n                timerProgressBar: true,\n                onOpen: (toast) => {\n                    toast.addEventListener('mouseenter', Swal.stopTimer);\n                    toast.addEventListener('mouseleave', Swal.resumeTimer);\n                }\n            });\n\n            Toast.fire({\n                icon: type,\n                title: message\n            });\n        };\n\n        return {\n            init: function(contextid) {\n                return new EditComment(contextid);\n            }\n        };\n    }\n);\n"],"file":"editcomment.min.js"}