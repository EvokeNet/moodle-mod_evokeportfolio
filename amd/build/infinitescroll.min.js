define("mod_evokeportfolio/infinitescroll",["jquery","core/ajax","core/templates","mod_evokeportfolio/tribute_init"],(function($,Ajax,Templates,TributeInit){var InfiniteScroll=function(courseid,initialtype){let groupactivity=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.courseid=courseid,this.tribute=TributeInit.init(),this.groupactivity=groupactivity,this.type=initialtype,this.targetdiv="#"+this.type+"portfolio",this.controlbutton=document.getElementById(this.type+"portfolio-tab"),this.type=this.controlbutton.dataset.timeline_type,this.offset=parseInt(this.controlbutton.dataset.timeline_offset),this.portfolioid=this.controlbutton.dataset.timeline_portfolioid,this.hasmoreitems=this.controlbutton.dataset.timeline_hasmoreitems,this.loadItems(),document.addEventListener("scroll",function(event){var scrollTop=event.target.scrollingElement.scrollTop,scrollHeight=event.target.scrollingElement.scrollHeight,offsetHeight=event.target.scrollingElement.offsetHeight;if(this.hasmoreitems&&!this.wait&&scrollTop+offsetHeight>scrollHeight-40){if(!this.hasmoreitems)return;this.wait||this.loadItems()}}.bind(this),!1),$(".nav-tabs .nav-link, .nav-pills .nav-link").click(function(event){this.controlbutton=event.target,this.type=event.target.dataset.timeline_type,this.offset=parseInt(event.target.dataset.timeline_offset),this.portfolioid=event.target.dataset.timeline_portfolioid,this.hasmoreitems="true"===event.target.dataset.timeline_hasmoreitems,this.targetdiv=event.target.dataset.target,this.loadItems()}.bind(this))};return InfiniteScroll.prototype.loadItems=function(){this.wait=!0;let methodname="mod_evokeportfolio_loadtimeline";this.groupactivity&&(methodname="mod_evokeportfolio_loadtimelinegroup");Ajax.call([{methodname:methodname,args:{courseid:this.courseid,type:this.type,offset:this.offset,portfolioid:this.portfolioid}}])[0].done(function(response){var data=JSON.parse(response.data);this.offset=parseInt(this.offset+1),this.controlbutton.dataset.timeline_offset=this.offset,this.hasmoreitems=data.hasmoreitems,this.controlbutton.dataset.timeline_hasmoreitems=data.hasmoreitems,this.handleLoadData(data)}.bind(this))},InfiniteScroll.prototype.handleLoadData=function(data){let template="mod_evokeportfolio/submission";this.groupactivity&&(template="mod_evokeportfolio/submission_group"),Templates.render(template,data).then(function(content){const targetdiv=$(this.targetdiv);targetdiv.find(".submission_loading-placeholder").addClass("hidden"),targetdiv.find(".submissions.timeline").append(content),this.tribute.reload(),this.wait=!1}.bind(this))},InfiniteScroll.prototype.courseid=0,InfiniteScroll.prototype.groupactivity=0,InfiniteScroll.prototype.type="my",InfiniteScroll.prototype.offset=0,InfiniteScroll.prototype.portfolioid=null,InfiniteScroll.prototype.hasmoreitems=!0,InfiniteScroll.prototype.targetdiv="#myportfolio",InfiniteScroll.prototype.wait=!1,InfiniteScroll.prototype.tribute=null,InfiniteScroll.prototype.controlbutton=null,{init:function(courseid,initialtype){let groupactivity=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return new InfiniteScroll(courseid,initialtype,groupactivity)}}}));

//# sourceMappingURL=infinitescroll.min.js.map