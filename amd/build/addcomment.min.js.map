{"version":3,"sources":["../src/addcomment.js"],"names":["define","$","Ajax","Swal","AddComment","registerEventListeners","prototype","document","on","event","inputtarget","currentTarget","closest","find","length","focus","keycode","keyCode","which","preventDefault","target","saveComment","html","bind","children","postinput","value","postdiv","empty","showToast","id","data","request","call","methodname","args","comment","submissionid","message","done","addCommentToPost","humantimecreated","fail","error","type","Toast","mixin","toast","position","showConfirmButton","timer","timerProgressBar","onOpen","addEventListener","stopTimer","resumeTimer","fire","icon","title","text","timecreated","userimg","clone","userfullname","attr","loadallcomments","append","insertBefore","totalcommentsspan","totalcomments"],"mappings":"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","sourcesContent":["/**\n * Add comment js logic.\n *\n * @package\n * @subpackage mod_evokeportfolio\n * @copyright  2021 World Bank Group <https://worldbank.org>\n * @author     Willian Mano <willianmanoaraujo@gmail.com>\n */\n\ndefine(['jquery', 'core/ajax', 'mod_evokeportfolio/sweetalert'], function($, Ajax, Swal) {\n    var AddComment = function() {\n        this.registerEventListeners();\n    };\n\n    AddComment.prototype.registerEventListeners = function() {\n        $(document).on('click', '.commentbutton', function(event) {\n            var inputtarget = $(event.currentTarget).closest('.submission')\n                .find('.add-comment .input-group .post-comment-input');\n\n            if (inputtarget.length > 0) {\n                inputtarget.focus();\n            }\n        });\n\n        $(document).on('click', '.post-comment-input', function(event) {\n            var keycode = (event.keyCode ? event.keyCode : event.which);\n\n            if (keycode === 13) {\n                event.preventDefault();\n\n                var target = $(event.currentTarget);\n\n                this.saveComment(target, target.html());\n            }\n        }.bind(this));\n\n        $(document).on('click', '.post-comment-btn', function(event) {\n            var target = $(event.currentTarget).closest('.input-group').children('.post-comment-input');\n\n            this.saveComment(target, target.html());\n        }.bind(this));\n    };\n\n    AddComment.prototype.saveComment = function(postinput, value) {\n        if (value === '') {\n            return;\n        }\n\n        var postdiv = postinput.closest('.submission');\n\n        postinput.empty();\n\n        if (postdiv.length === 0 || postdiv.length > 1) {\n            this.showToast('error', 'Error trying to find the discussion for this comment.');\n\n            return;\n        }\n\n        var id = postdiv.data('id');\n\n        var request = Ajax.call([{\n            methodname: 'mod_evokeportfolio_addcomment',\n            args: {\n                comment: {\n                    submissionid: id,\n                    message: value,\n                }\n            }\n        }]);\n\n        request[0].done(function(data) {\n            this.addCommentToPost(postdiv, data.message, data.humantimecreated);\n        }.bind(this)).fail(function(error) {\n            var message = error.message;\n\n            if (!message) {\n                message = error.error;\n            }\n\n            this.showToast('error', message);\n        }.bind(this));\n    };\n\n    AddComment.prototype.showToast = function(type, message) {\n        var Toast = Swal.mixin({\n            toast: true,\n            position: 'top-end',\n            showConfirmButton: false,\n            timer: 8000,\n            timerProgressBar: true,\n            onOpen: (toast) => {\n                toast.addEventListener('mouseenter', Swal.stopTimer);\n                toast.addEventListener('mouseleave', Swal.resumeTimer);\n            }\n        });\n\n        Toast.fire({\n            icon: type,\n            title: message\n        });\n    };\n\n    AddComment.prototype.addCommentToPost = function(postdiv, text, timecreated) {\n        var userimg = postdiv.find('.add-comment .userimg').clone();\n        var userfullname = userimg.attr('alt');\n        var loadallcomments = postdiv.find('.loadmore');\n\n        var comment = $(\"<div class='submissioncomment fadeIn'>\" +\n          \"<div class='userinfo'>\" +\n            \"<div class='userimg'>\" + $('<div/>').append(userimg).html() + \"</div>\" +\n            \"<div class='nameanddate'>\" +\n                \"<p class='username'>\" + userfullname + \"</p>\" +\n                \"<span class='small'>\" + timecreated + \"</span>\"+\n            \"</div>\"+\n          \"</div>\"+\n          \"<p class='text'>\" + text + \"</p>\" +\n        \"</div>\");\n\n        if (loadallcomments.length > 0) {\n            comment.insertBefore(loadallcomments);\n        } else {\n            comment.insertBefore(postdiv.find('.add-comment'));\n        }\n\n        var totalcommentsspan = postdiv.find('.reactions .actions .commentbutton .totalcomments');\n        var totalcomments = postdiv.find('.submissioncomment').length;\n\n        totalcommentsspan.empty();\n\n        totalcommentsspan.text(totalcomments);\n    };\n\n    return {\n        'init': function() {\n            return new AddComment();\n        }\n    };\n});\n"],"file":"addcomment.min.js"}