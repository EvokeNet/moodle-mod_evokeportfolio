{"version":3,"file":"addcomment.min.js","sources":["../src/addcomment.js"],"sourcesContent":["/**\n * Add comment js logic.\n *\n * @package\n * @subpackage mod_evokeportfolio\n * @copyright  2021 World Bank Group <https://worldbank.org>\n * @author     Willian Mano <willianmanoaraujo@gmail.com>\n */\n\ndefine(['jquery', 'core/str', 'core/ajax', 'mod_evokeportfolio/sweetalert'], function($, Str, Ajax, Swal) {\n    var AddComment = function() {\n        this.registerEventListeners();\n    };\n\n    AddComment.prototype.registerEventListeners = function() {\n        $(document).on('click', '.commentbutton', function(event) {\n            var inputtarget = $(event.currentTarget).closest('.submission')\n                .find('.add-comment .input-group .post-comment-input');\n\n            if (inputtarget.length > 0) {\n                inputtarget.focus();\n            }\n        });\n\n        $(document).on('click', '.post-comment-btn', function(event) {\n            var target = $(event.currentTarget).closest('.input-group').children('.post-comment-input');\n\n            if (target) {\n                this.saveComment(target, target.html());\n            }\n        }.bind(this));\n    };\n\n    AddComment.prototype.saveComment = function(postinput, value) {\n        if (value === '') {\n            return;\n        }\n\n        var postdiv = postinput.closest('.submission');\n\n        postinput.empty();\n\n        if (postdiv.length === 0 || postdiv.length > 1) {\n            this.showToast('error', 'Error trying to find the discussion for this comment.');\n\n            return;\n        }\n\n        var id = postdiv.data('id');\n\n        var request = Ajax.call([{\n            methodname: 'mod_evokeportfolio_addcomment',\n            args: {\n                comment: {\n                    submissionid: id,\n                    message: value,\n                }\n            }\n        }]);\n\n        request[0].done(function(data) {\n            this.addCommentToPost(postdiv, data.comment);\n        }.bind(this)).fail(function(error) {\n            var message = error.message;\n\n            if (!message) {\n                message = error.error;\n            }\n\n            this.showToast('error', message);\n        }.bind(this));\n    };\n\n    AddComment.prototype.showToast = function(type, message) {\n        var Toast = Swal.mixin({\n            toast: true,\n            position: 'top-end',\n            showConfirmButton: false,\n            timer: 8000,\n            timerProgressBar: true,\n            onOpen: (toast) => {\n                toast.addEventListener('mouseenter', Swal.stopTimer);\n                toast.addEventListener('mouseleave', Swal.resumeTimer);\n            }\n        });\n\n        Toast.fire({\n            icon: type,\n            title: message\n        });\n    };\n\n    AddComment.prototype.addCommentToPost = function(postdiv, comment) {\n        Str.get_string('editcomment', 'mod_evokeportfolio').then(function(editcomment) {\n            var userimg = postdiv.find('.add-comment .userimg').clone();\n            var userfullname = userimg.attr('alt');\n            var loadallcomments = postdiv.find('.loadmore');\n\n            var commentcontainer = $(\"<div class='submissioncomment fadeIn'>\" +\n                \"<div class='userinfo'>\" +\n                \"<div class='userimg'>\" + $('<div/>').append(userimg).html() + \"</div>\" +\n                \"<div class='nameanddate'>\" +\n                \"<p class='username'>\" + userfullname + \"</p>\" +\n                \"<span class='small'>\" + comment.humantimecreated + \"</span>\"+\n                \"</div>\"+\n                \"<div class='editbutton ml-auto'>\"+\n                \"<a class='btn-editcomment btn btn-sm btn-primary' data-id='\"+comment.id+\"'>\"+editcomment+\"</a>\"+\n                \"</div>\"+\n                \"</div>\"+\n                \"<p class='text'>\" + comment.message + \"</p>\" +\n                \"</div>\");\n\n            if (loadallcomments.length > 0) {\n                commentcontainer.insertBefore(loadallcomments);\n            } else {\n                commentcontainer.insertBefore(postdiv.find('.add-comment'));\n            }\n\n            var totalcommentsspan = postdiv.find('.reactions .actions .commentbutton .totalcomments');\n            var totalcomments = postdiv.find('.submissioncomment').length;\n\n            totalcommentsspan.empty();\n\n            totalcommentsspan.text(totalcomments);\n        });\n    };\n\n    return {\n        'init': function() {\n            return new AddComment();\n        }\n    };\n});\n"],"names":["define","$","Str","Ajax","Swal","AddComment","registerEventListeners","prototype","document","on","event","inputtarget","currentTarget","closest","find","length","focus","target","children","saveComment","html","bind","this","postinput","value","postdiv","empty","showToast","id","data","call","methodname","args","comment","submissionid","message","done","addCommentToPost","fail","error","type","mixin","toast","position","showConfirmButton","timer","timerProgressBar","onOpen","addEventListener","stopTimer","resumeTimer","fire","icon","title","get_string","then","editcomment","userimg","clone","userfullname","attr","loadallcomments","commentcontainer","append","humantimecreated","insertBefore","totalcommentsspan","totalcomments","text"],"mappings":"AASAA,uCAAO,CAAC,SAAU,WAAY,YAAa,kCAAkC,SAASC,EAAGC,IAAKC,KAAMC,UAC5FC,WAAa,gBACRC,iCAGTD,WAAWE,UAAUD,uBAAyB,WAC1CL,EAAEO,UAAUC,GAAG,QAAS,kBAAkB,SAASC,WAC3CC,YAAcV,EAAES,MAAME,eAAeC,QAAQ,eAC5CC,KAAK,iDAENH,YAAYI,OAAS,GACrBJ,YAAYK,WAIpBf,EAAEO,UAAUC,GAAG,QAAS,oBAAqB,SAASC,WAC9CO,OAAShB,EAAES,MAAME,eAAeC,QAAQ,gBAAgBK,SAAS,uBAEjED,aACKE,YAAYF,OAAQA,OAAOG,SAEtCC,KAAKC,QAGXjB,WAAWE,UAAUY,YAAc,SAASI,UAAWC,UACrC,KAAVA,WAIAC,QAAUF,UAAUV,QAAQ,kBAEhCU,UAAUG,QAEa,IAAnBD,QAAQV,QAAgBU,QAAQV,OAAS,OACpCY,UAAU,QAAS,kEAKxBC,GAAKH,QAAQI,KAAK,MAER1B,KAAK2B,KAAK,CAAC,CACrBC,WAAY,gCACZC,KAAM,CACFC,QAAS,CACLC,aAAcN,GACdO,QAASX,WAKb,GAAGY,KAAK,SAASP,WAChBQ,iBAAiBZ,QAASI,KAAKI,UACtCZ,KAAKC,OAAOgB,KAAK,SAASC,WACpBJ,QAAUI,MAAMJ,QAEfA,UACDA,QAAUI,MAAMA,YAGfZ,UAAU,QAASQ,UAC1Bd,KAAKC,UAGXjB,WAAWE,UAAUoB,UAAY,SAASa,KAAML,SAChC/B,KAAKqC,MAAM,CACnBC,OAAO,EACPC,SAAU,UACVC,mBAAmB,EACnBC,MAAO,IACPC,kBAAkB,EAClBC,OAASL,QACLA,MAAMM,iBAAiB,aAAc5C,KAAK6C,WAC1CP,MAAMM,iBAAiB,aAAc5C,KAAK8C,gBAI5CC,KAAK,CACPC,KAAMZ,KACNa,MAAOlB,WAIf9B,WAAWE,UAAU8B,iBAAmB,SAASZ,QAASQ,SACtD/B,IAAIoD,WAAW,cAAe,sBAAsBC,MAAK,SAASC,iBAC1DC,QAAUhC,QAAQX,KAAK,yBAAyB4C,QAChDC,aAAeF,QAAQG,KAAK,OAC5BC,gBAAkBpC,QAAQX,KAAK,aAE/BgD,iBAAmB7D,EAAE,oFAEKA,EAAE,UAAU8D,OAAON,SAASrC,OAFjC,sDAIIuC,aAJJ,2BAKI1B,QAAQ+B,iBALZ,2GAQyC/B,QAAQL,GAAG,KAAK4B,YARzD,mCAWAvB,QAAQE,QAXR,cAcrB0B,gBAAgB9C,OAAS,EACzB+C,iBAAiBG,aAAaJ,iBAE9BC,iBAAiBG,aAAaxC,QAAQX,KAAK,qBAG3CoD,kBAAoBzC,QAAQX,KAAK,qDACjCqD,cAAgB1C,QAAQX,KAAK,sBAAsBC,OAEvDmD,kBAAkBxC,QAElBwC,kBAAkBE,KAAKD,mBAIxB,MACK,kBACG,IAAI9D"}