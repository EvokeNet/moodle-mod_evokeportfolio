{"version":3,"sources":["../src/loadtimelineevokation.js"],"names":["define","$","Ajax","Templates","TributeInit","LoadTimelineEvokation","courseid","tribute","init","controlbutton","document","getElementById","type","dataset","timeline_type","offset","parseInt","timeline_offset","hasmoreitems","timeline_hasmoreitems","loadItems","addEventListener","event","scrollTop","target","scrollingElement","scrollHeight","offsetHeight","wait","bind","click","targetdiv","prototype","request","call","methodname","args","done","response","data","JSON","parse","handleLoadData","render","then","content","find","addClass","append","reload","portfolioid"],"mappings":"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","sourcesContent":["/**\n * Load evokation timeline js logic.\n *\n * @package\n * @subpackage mod_evokeportfolio\n * @copyright  2021 World Bank Group <https://worldbank.org>\n * @author     Willian Mano <willianmanoaraujo@gmail.com>\n */\n/* eslint-disable */\ndefine(['jquery', 'core/ajax', 'core/templates', 'mod_evokeportfolio/tribute_init'], function($, Ajax, Templates, TributeInit) {\n    var LoadTimelineEvokation = function(courseid) {\n        this.courseid = courseid;\n\n        this.tribute = TributeInit.init();\n\n        this.controlbutton = document.getElementById('myevokation-tab');\n\n        this.type = this.controlbutton.dataset.timeline_type;\n        this.offset = parseInt(this.controlbutton.dataset.timeline_offset);\n        this.hasmoreitems = this.controlbutton.dataset.timeline_hasmoreitems;\n\n        this.loadItems();\n\n        document.addEventListener('scroll', function(event) {\n            var scrollTop = event.target.scrollingElement.scrollTop;\n            var scrollHeight = event.target.scrollingElement.scrollHeight;\n            var offsetHeight = event.target.scrollingElement.offsetHeight;\n\n            if (this.hasmoreitems && !this.wait && (scrollTop + offsetHeight > scrollHeight - 40)) {\n                if (!this.hasmoreitems) {\n                    return;\n                }\n\n                if (!this.wait) {\n                    this.loadItems();\n                }\n            }\n        }.bind(this), false);\n\n        $('.nav-tabs .nav-link').click(function(event) {\n            this.controlbutton = event.target;\n\n            this.type = event.target.dataset.timeline_type;\n            this.offset = parseInt(event.target.dataset.timeline_offset);\n            this.hasmoreitems = event.target.dataset.timeline_hasmoreitems === 'true';\n\n            this.targetdiv = event.target.dataset.target;\n\n            this.loadItems();\n        }.bind(this));\n    }\n\n    LoadTimelineEvokation.prototype.loadItems = function() {\n        this.wait = true;\n\n        const request = Ajax.call([{\n            methodname: 'mod_evokeportfolio_loadtimelineevokation',\n            args: {\n                courseid: this.courseid,\n                type: this.type,\n                offset: this.offset\n            }\n        }]);\n\n        request[0].done(function(response) {\n            var data = JSON.parse(response.data);\n\n            this.offset = parseInt(this.offset + 1);\n            this.controlbutton.dataset.timeline_offset = this.offset;\n            this.hasmoreitems = data.hasmoreitems;\n            this.controlbutton.dataset.timeline_hasmoreitems = data.hasmoreitems;\n\n            this.handleLoadData(data);\n        }.bind(this));\n    };\n\n    LoadTimelineEvokation.prototype.handleLoadData = function(data) {\n        Templates.render('mod_evokeportfolio/submission', data).then(function(content) {\n            const targetdiv = $(this.targetdiv);\n\n            targetdiv.find('.submission_loading-placeholder').addClass('hidden');\n\n            targetdiv.find('.submissions.timeline').append(content);\n\n            this.tribute.reload();\n\n            this.wait = false;\n        }.bind(this));\n    };\n\n    LoadTimelineEvokation.prototype.courseid = 0;\n\n    LoadTimelineEvokation.prototype.type = 'my';\n\n    LoadTimelineEvokation.prototype.offset = 0;\n\n    LoadTimelineEvokation.prototype.portfolioid = null;\n\n    LoadTimelineEvokation.prototype.hasmoreitems = true;\n\n    LoadTimelineEvokation.prototype.targetdiv = '#myevokation';\n\n    LoadTimelineEvokation.prototype.wait = false;\n\n    LoadTimelineEvokation.prototype.tribute = null;\n\n    LoadTimelineEvokation.prototype.controlbutton = null;\n\n    return {\n        'init': function(courseid) {\n            return new LoadTimelineEvokation(courseid);\n        }\n    };\n});\n"],"file":"loadtimelineevokation.min.js"}