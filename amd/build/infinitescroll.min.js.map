{"version":3,"file":"infinitescroll.min.js","sources":["../src/infinitescroll.js"],"sourcesContent":["/**\n * Add comment js logic.\n *\n * @package\n * @subpackage mod_evokeportfolio\n * @copyright  2021 World Bank Group <https://worldbank.org>\n * @author     Willian Mano <willianmanoaraujo@gmail.com>\n */\n/* eslint-disable */\ndefine(['jquery', 'core/ajax', 'core/templates', 'mod_evokeportfolio/tribute_init'], function($, Ajax, Templates, TributeInit) {\n    var InfiniteScroll = function(courseid, initialtype, groupactivity = false) {\n        this.courseid = courseid;\n\n        this.tribute = TributeInit.init();\n\n        this.groupactivity = groupactivity;\n\n        this.type = initialtype;\n\n        this.targetdiv = '#' + this.type + 'portfolio';\n\n        this.controlbutton = document.getElementById(this.type + 'portfolio-tab');\n\n        this.type = this.controlbutton.dataset.timeline_type;\n        this.offset = parseInt(this.controlbutton.dataset.timeline_offset);\n        this.portfolioid = this.controlbutton.dataset.timeline_portfolioid;\n        this.hasmoreitems = this.controlbutton.dataset.timeline_hasmoreitems;\n\n        this.loadItems();\n\n        document.addEventListener('scroll', function(event) {\n            var scrollTop = event.target.scrollingElement.scrollTop;\n            var scrollHeight = event.target.scrollingElement.scrollHeight;\n            var offsetHeight = event.target.scrollingElement.offsetHeight;\n\n            if (this.hasmoreitems && !this.wait && (scrollTop + offsetHeight > scrollHeight - 40)) {\n                if (!this.hasmoreitems) {\n                    return;\n                }\n\n                if (!this.wait) {\n                    this.loadItems();\n                }\n            }\n        }.bind(this), false);\n\n        $('.nav-tabs .nav-link, .nav-pills .nav-link').click(function(event) {\n            this.controlbutton = event.target;\n\n            this.type = event.target.dataset.timeline_type;\n            this.offset = parseInt(event.target.dataset.timeline_offset);\n            this.portfolioid = event.target.dataset.timeline_portfolioid;\n            this.hasmoreitems = event.target.dataset.timeline_hasmoreitems === 'true';\n\n            this.targetdiv = event.target.dataset.target;\n\n            this.loadItems();\n        }.bind(this));\n    }\n\n    InfiniteScroll.prototype.loadItems = function() {\n        this.wait = true;\n\n        let methodname = 'mod_evokeportfolio_loadtimeline';\n\n        if (this.groupactivity) {\n            methodname = 'mod_evokeportfolio_loadtimelinegroup';\n        }\n\n        const request = Ajax.call([{\n            methodname: methodname,\n            args: {\n                courseid: this.courseid,\n                type: this.type,\n                offset: this.offset,\n                portfolioid: this.portfolioid\n            }\n        }]);\n\n        request[0].done(function(response) {\n            var data = JSON.parse(response.data);\n\n            this.offset = parseInt(this.offset + 1);\n            this.controlbutton.dataset.timeline_offset = this.offset;\n            this.hasmoreitems = data.hasmoreitems;\n            this.controlbutton.dataset.timeline_hasmoreitems = data.hasmoreitems;\n\n            this.handleLoadData(data);\n        }.bind(this));\n    };\n\n    InfiniteScroll.prototype.handleLoadData = function(data) {\n        let template = 'mod_evokeportfolio/submission';\n\n        if (this.groupactivity) {\n            template = 'mod_evokeportfolio/submission_group';\n        }\n\n        Templates.render(template, data).then(function(content) {\n            const targetdiv = $(this.targetdiv);\n\n            targetdiv.find('.submission_loading-placeholder').addClass('hidden');\n\n            targetdiv.find('.submissions.timeline').append(content);\n\n            this.tribute.reload();\n\n            this.wait = false;\n        }.bind(this));\n    };\n\n    InfiniteScroll.prototype.courseid = 0;\n\n    InfiniteScroll.prototype.groupactivity = 0;\n\n    InfiniteScroll.prototype.type = 'my';\n\n    InfiniteScroll.prototype.offset = 0;\n\n    InfiniteScroll.prototype.portfolioid = null;\n\n    InfiniteScroll.prototype.hasmoreitems = true;\n\n    InfiniteScroll.prototype.targetdiv = '#myportfolio';\n\n    InfiniteScroll.prototype.wait = false;\n\n    InfiniteScroll.prototype.tribute = null;\n\n    InfiniteScroll.prototype.controlbutton = null;\n\n    return {\n        'init': function(courseid, initialtype, groupactivity = false) {\n            return new InfiniteScroll(courseid, initialtype, groupactivity);\n        }\n    };\n});\n"],"names":["define","$","Ajax","Templates","TributeInit","InfiniteScroll","courseid","initialtype","groupactivity","tribute","init","type","targetdiv","this","controlbutton","document","getElementById","dataset","timeline_type","offset","parseInt","timeline_offset","portfolioid","timeline_portfolioid","hasmoreitems","timeline_hasmoreitems","loadItems","addEventListener","event","scrollTop","target","scrollingElement","scrollHeight","offsetHeight","wait","bind","click","prototype","methodname","call","args","done","response","data","JSON","parse","handleLoadData","template","render","then","content","find","addClass","append","reload"],"mappings":"AASAA,2CAAO,CAAC,SAAU,YAAa,iBAAkB,oCAAoC,SAASC,EAAGC,KAAMC,UAAWC,iBAC1GC,eAAiB,SAASC,SAAUC,iBAAaC,2EAC5CF,SAAWA,cAEXG,QAAUL,YAAYM,YAEtBF,cAAgBA,mBAEhBG,KAAOJ,iBAEPK,UAAY,IAAMC,KAAKF,KAAO,iBAE9BG,cAAgBC,SAASC,eAAeH,KAAKF,KAAO,sBAEpDA,KAAOE,KAAKC,cAAcG,QAAQC,mBAClCC,OAASC,SAASP,KAAKC,cAAcG,QAAQI,sBAC7CC,YAAcT,KAAKC,cAAcG,QAAQM,0BACzCC,aAAeX,KAAKC,cAAcG,QAAQQ,2BAE1CC,YAELX,SAASY,iBAAiB,SAAU,SAASC,WACrCC,UAAYD,MAAME,OAAOC,iBAAiBF,UAC1CG,aAAeJ,MAAME,OAAOC,iBAAiBC,aAC7CC,aAAeL,MAAME,OAAOC,iBAAiBE,gBAE7CpB,KAAKW,eAAiBX,KAAKqB,MAASL,UAAYI,aAAeD,aAAe,GAAK,KAC9EnB,KAAKW,oBAILX,KAAKqB,WACDR,cAGfS,KAAKtB,OAAO,GAEdZ,EAAE,6CAA6CmC,MAAM,SAASR,YACrDd,cAAgBc,MAAME,YAEtBnB,KAAOiB,MAAME,OAAOb,QAAQC,mBAC5BC,OAASC,SAASQ,MAAME,OAAOb,QAAQI,sBACvCC,YAAcM,MAAME,OAAOb,QAAQM,0BACnCC,aAA8D,SAA/CI,MAAME,OAAOb,QAAQQ,2BAEpCb,UAAYgB,MAAME,OAAOb,QAAQa,YAEjCJ,aACPS,KAAKtB,eAGXR,eAAegC,UAAUX,UAAY,gBAC5BQ,MAAO,MAERI,WAAa,kCAEbzB,KAAKL,gBACL8B,WAAa,wCAGDpC,KAAKqC,KAAK,CAAC,CACvBD,WAAYA,WACZE,KAAM,CACFlC,SAAUO,KAAKP,SACfK,KAAME,KAAKF,KACXQ,OAAQN,KAAKM,OACbG,YAAaT,KAAKS,gBAIlB,GAAGmB,KAAK,SAASC,cACjBC,KAAOC,KAAKC,MAAMH,SAASC,WAE1BxB,OAASC,SAASP,KAAKM,OAAS,QAChCL,cAAcG,QAAQI,gBAAkBR,KAAKM,YAC7CK,aAAemB,KAAKnB,kBACpBV,cAAcG,QAAQQ,sBAAwBkB,KAAKnB,kBAEnDsB,eAAeH,OACtBR,KAAKtB,QAGXR,eAAegC,UAAUS,eAAiB,SAASH,UAC3CI,SAAW,gCAEXlC,KAAKL,gBACLuC,SAAW,uCAGf5C,UAAU6C,OAAOD,SAAUJ,MAAMM,KAAK,SAASC,eACrCtC,UAAYX,EAAEY,KAAKD,WAEzBA,UAAUuC,KAAK,mCAAmCC,SAAS,UAE3DxC,UAAUuC,KAAK,yBAAyBE,OAAOH,cAE1CzC,QAAQ6C,cAERpB,MAAO,GACdC,KAAKtB,QAGXR,eAAegC,UAAU/B,SAAW,EAEpCD,eAAegC,UAAU7B,cAAgB,EAEzCH,eAAegC,UAAU1B,KAAO,KAEhCN,eAAegC,UAAUlB,OAAS,EAElCd,eAAegC,UAAUf,YAAc,KAEvCjB,eAAegC,UAAUb,cAAe,EAExCnB,eAAegC,UAAUzB,UAAY,eAErCP,eAAegC,UAAUH,MAAO,EAEhC7B,eAAegC,UAAU5B,QAAU,KAEnCJ,eAAegC,UAAUvB,cAAgB,KAElC,MACK,SAASR,SAAUC,iBAAaC,6EAC7B,IAAIH,eAAeC,SAAUC,YAAaC"}