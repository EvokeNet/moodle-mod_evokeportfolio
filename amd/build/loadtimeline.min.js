define("mod_evokeportfolio/loadtimeline",["jquery","core/ajax","core/templates","mod_evokeportfolio/tribute_init"],(function($,Ajax,Templates,TributeInit){var LoadTimeline=function(courseid,evokation){this.courseid=courseid,this.evokation=evokation,this.tribute=TributeInit.init(),this.controlbutton=document.getElementById("myportfolio-tab"),this.type=this.controlbutton.dataset.timeline_type,this.offset=parseInt(this.controlbutton.dataset.timeline_offset),this.portfolioid=this.controlbutton.dataset.timeline_portfolioid,this.hasmoreitems=this.controlbutton.dataset.timeline_hasmoreitems,this.loadItems(),document.addEventListener("scroll",function(event){var scrollTop=event.target.scrollingElement.scrollTop,scrollHeight=event.target.scrollingElement.scrollHeight,offsetHeight=event.target.scrollingElement.offsetHeight;if(this.hasmoreitems&&!this.wait&&scrollTop+offsetHeight>scrollHeight-40){if(!this.hasmoreitems)return;this.wait||this.loadItems()}}.bind(this),!1),$(".nav-tabs .nav-link, .nav-pills .nav-link").click(function(event){this.controlbutton=event.target,this.type=event.target.dataset.timeline_type,this.offset=parseInt(event.target.dataset.timeline_offset),this.portfolioid=event.target.dataset.timeline_portfolioid,this.hasmoreitems="true"===event.target.dataset.timeline_hasmoreitems,this.targetdiv=event.target.dataset.target,this.loadItems()}.bind(this))};return LoadTimeline.prototype.loadItems=function(){this.wait=!0;Ajax.call([{methodname:"mod_evokeportfolio_loadtimeline",args:{courseid:this.courseid,type:this.type,offset:this.offset,portfolioid:this.portfolioid}}])[0].done(function(response){var data=JSON.parse(response.data);this.offset=parseInt(this.offset+1),this.controlbutton.dataset.timeline_offset=this.offset,this.hasmoreitems=data.hasmoreitems,this.controlbutton.dataset.timeline_hasmoreitems=data.hasmoreitems,this.handleLoadData(data)}.bind(this))},LoadTimeline.prototype.handleLoadData=function(data){Templates.render("mod_evokeportfolio/submission",data).then(function(content){const targetdiv=$(this.targetdiv);targetdiv.find(".submission_loading-placeholder").addClass("hidden"),targetdiv.find(".submissions.timeline").append(content),this.tribute.reload(),this.wait=!1}.bind(this))},LoadTimeline.prototype.courseid=0,LoadTimeline.prototype.type="my",LoadTimeline.prototype.offset=0,LoadTimeline.prototype.portfolioid=null,LoadTimeline.prototype.hasmoreitems=!0,LoadTimeline.prototype.targetdiv="#myportfolio",LoadTimeline.prototype.wait=!1,LoadTimeline.prototype.tribute=null,LoadTimeline.prototype.controlbutton=null,{init:function(courseid){let evokation=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new LoadTimeline(courseid,evokation)}}}));

//# sourceMappingURL=loadtimeline.min.js.map